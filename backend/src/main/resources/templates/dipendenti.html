<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="utf-8">
    <title>Docufy</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="../static/favicon.ico">

    <!-- Vendor CSS Files -->
    <link rel="stylesheet" href="/style.css">
    <!-- BootStrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

</head>

<body class="dipendenti-body">

<div class="container">
    <div class="row justify-content-center">
        <div class="pagetitle">
            <h1>Dipendenti</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">Dashboard</li>
                    <li class="breadcrumb-item active">Dipendenti</li>
                </ol>
            </nav>
        </div><!-- End Page Title -->
            <div class="card">
                <div class="card-body">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table align-middle mb-0 bg-white">
                                    <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Ruolo</th>
                                        <th>Data Assunzione</th>
                                        <th>Azioni</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <!-- Use Thymeleaf each loop to iterate over the list of employees -->
                                    <tr th:each="dipendente : ${dipendenti}">
                                        <td>
                                            <p class="fw-bold mb-1" th:text="${dipendente.cognome} + ' ' + ${dipendente.nome}"></p>
                                            <p class="text-muted mb-0" th:text="${dipendente.email}"></p>
                                        </td>
                                        <td th:text="${dipendente.ruolo}"></td>
                                        <td th:text="${#dates.format(dipendente.dataAssunzione, 'dd/MM/yyyy')}"></td>
                                        <td>
                                            <a href="#" th:onclick="'eliminaDipendente(\'' + ${dipendente.id} + '\'); return false;'">Elimina</a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</div>

<!-- Vendor JS Files -->
<script src="/script.js"></script>

<script>
    function eliminaDipendente(dipendenteId) {
        var conferma = confirm("Sei sicuro di voler eliminare questo dipendente?");
        if (conferma) {
            // Invia la richiesta di eliminazione al servlet usando fetch
            fetch('/all-dipendenti', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'action=elimina&dipendenteId=' + dipendenteId,
            })
                .then(response => {
                    if (response.ok) {
                        console.log('Eliminazione riuscita');
                        window.location.reload();
                    } else {
                        console.error('Errore durante l\'eliminazione');
                        window.location.href = '/not-authorized.html';
                    }
                })
                .catch(error => {
                    console.error('Errore durante la richiesta:', error);
                });
        }
    }
</script>



</body>

<footer id="footer" class="footer">
    <div class="container">
        <div class="row justify-content-center">

    <div class="copyright">
        <a href="/templates/dipendenti.html"> &copy;Copyright</a><strong><span> Docufy</span></strong>. Tutti i diritti riservati
    </div>

    <div class="credits">
        <p>Sito realizzato con passione da: <strong>Campanella Gianluca</strong>, <strong>Curcio Daniel</strong>,<br>
            <strong>Falvo Caterina</strong> e <strong>Gattuso Pietro</strong></p>
    </div>
        </div>
    </div>

</footer><!-- End Footer -->

</html>
